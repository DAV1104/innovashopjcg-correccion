<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../static/css/inicio_empresas.css">
  <title>Inicio Empresas</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <nav class="menu" tabindex="0">
    <div class="smartphone-menu-trigger"></div>
    <header class="avatar">
      <img src="../static/img/icono-empresa.png" />
      <h2 style="color: #070707; font-weight: bold" id="empresa-name">Loading...</h2>
      <h2 style="font-size: 15px; color: #070707" id="empresa-rol">Loading...</h2>
    </header>
    <ul>
      <a href="/empresa/home"><li tabindex="0" class="icon-inicio">
        <span>Inicio</span>
      </li></a>
      <a href="descuentos-empresas.html"><li tabindex="0" class="icon-descuentos">
        <span>Descuentos</span>
      </li></a>
      <a href="vendedores-empresas.html"><li tabindex="0" class="icon-vendedores"><span>Vendedores</span></li></a>
      <a href="/empresa/clientes"><li tabindex="0" class="icon-clientes"><span>Clientes</span></li></a>
      <a href="stock-empresas.html"><li tabindex="0" class="icon-stock"><span>Stock</span></li></a>
      <a href="cotizacion-empresas.html"><li tabindex="0" class="icon-cotizacion"><span>Cotizacion</span></li></a>
      <a href="compras-empresas.html"><li tabindex="0" class="icon-compra"><span>Compra</span></li></a>
    </ul>

    <div class="Contenedor">
      <a href="/acceder" class="button-cerrar-sesion">Cerrar sesion</a>
      <a href="/user/login" class="button-cambiar-cuenta">Cambiar cuenta</a>
    </div>
  </nav>
  <main>
    <div class="helper">
      <div><strong>Bienvenido</strong></div>
      <div><span>¿Qué desea hacer hoy?</span></div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const empresaNameElem = document.getElementById('empresa-name');
      const empresaRolElem = document.getElementById('empresa-rol');

      const checkStatusAndUpdateInfo = () => {
        axios.get('/empresa/empresa-info')
          .then(function(response) {
            const empresaData = response.data;
            empresaNameElem.textContent = empresaData.nombre;
            empresaRolElem.textContent = empresaData.rol;

            if (empresaData.estado !== 'activo') {
              Swal.fire({
                icon: 'error',
                title: 'Empresa Inactiva',
                text: 'La empresa se encuentra inactiva. Por favor, solicite más tiempo de acceso.',
                allowOutsideClick: false,
                allowEscapeKey: false
              }).then(() => {
                window.location.href = '/user/login';
              });
            }
          })
          .catch(function(error) {
            console.error('Error fetching empresa info:', error);
            empresaNameElem.textContent = 'Error';
          });
      };

      // Call the function on page load
      checkStatusAndUpdateInfo();

      // Set an interval to check the status every 30 seconds (30000 milliseconds)
      setInterval(checkStatusAndUpdateInfo, 30000); // 5 minutes
    });
  </script>
</body>
</html>
